<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Briefmarkenrechner</title>
		<script src="https://code.jquery.com/jquery-latest.js"></script>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<style>
			.output{
				margin-bottom: 25px;
			}
			.briefmarke{
				color: white;
				background-color: black;
				margin: 10px 10px 10px 10px;
				text-align: center;
				padding: 10px; 10px; 10px; 10px;
			}
		</style>
	</head>
	<header>
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<div class="container">
				<a class="navbar-brand" href="index.html">Briefmarkenrechner</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarSupportedContent">
					<ul class="navbar-nav mr-auto">
						<li class="nav-item active">
							<a class="nav-link" href="index.html">Startseite <span class="sr-only">(current)</span></a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">Porto</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">Briefmarken</a>
						</li>
			  		</ul>
				</div>
			</div>
		</nav>
	</header>

	<body>
		<div class="container" style="margin-top:100px">
			<div class="form-group">
				<label for="exampleFormControlSelect1">Geben Sie einen Betrag ein:</label>
				<div class="input-group mb-3">
					<input class="form-control" autofocus="autofocus" id="portoInputUser" type="number" min="0" step="0.01" placeholder="Briefporto bitte hier eingeben"></input>
					<div class="input-group-append">
						<button class="btn btn-outline-secondary" type="button" id="portoInputUserSend" onclick="">Go!</button>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label for="exampleFormControlSelect1">Oder wählen Sie eine Versandart:</label>
				<select class="form-control" id="portoInputUserSelect">
					<option value="0.7">Standardbrief: 0,70 € (bis 20g)</option>
					<option value="0.85">Kompaktbrief: 0,85 € (bis 50g)</option>
					<option value="1.45">Großbrief: 1,45 € (bis 500g)</option>
					<option value="2.6">Maxibrief: 2,60 € (bis 1000g)</option>
					<option value="0.45">Postkarte: 0,45 €</option>
				</select>
			</div>
			<div class="form-group">
				<label for="exampleFormControlSelect1">Maximale Anzahl an Briefmarken:</label>
				<div class="input-group mb-3">
					<input class="form-control" id="anzahlInputUser" type="number" min="1" value="4"></input>
					<div class="input-group-append">
						<button class="btn btn-outline-secondary" type="button" id="anzahlInputUserSend" onclick="">Go!</button>
					</div>
				</div>
			</div>
		</div>
		<div class="container" id="displayAktuelleAuswahl" style="margin-top:100px"></div>
		<script>		
			var aktuellesPorto;
			var briefmarken = [0.01, 0.02, 0.05, 0.10, 0.20, 0.45, 0.70, 1, 1.45]
			var moeglichkeiten = [];
			var neuesPorto = [];
			var anzahlBriefmarken;

			function output(){
				var output = '';
				for(var i = 0; moeglichkeiten.length > i; i++){
					var adden = '';
					moeglichkeiten[i].forEach(function(item2, index, array) {
						adden += '<div class="col-sm briefmarke">' + item2 + ' € </div>';
					});
					output += '<div class="container"><div class="row">' + adden + '</div></div>';
				};
				document.getElementById('displayAktuelleAuswahl').innerHTML=output;
			}

			function glattTeilbar(){
				neuesPorto = [];
				for (var i = 0; i < briefmarken.length; i++){
					var differenz = Math.round((aktuellesPorto - briefmarken[i])*100)/100;
					if(differenz==0){
						//console.log('Es wurde eine optimale Lösung gefunden: ' + briefmarken[i])
						moeglichkeiten.push([briefmarken[i]]);
					}
					else{
						neuesPorto.push([differenz, [briefmarken[i]]]);
					}
				}
				//console.log(neuesPorto);
				
			}

			function algorithmus(){
				var neuneuesPorto = [];
				for (var i = 0; i < neuesPorto.length; i++){
					for (var j = 0; j < briefmarken.length; j++){
						var differenz = Math.round((neuesPorto[i][0] - briefmarken[j])*100)/100;
						if(differenz<0){}
						else{
							var aktuelleBriefmarke = briefmarken[j];
							var vorherigeBriefmarken = neuesPorto[i][1];
							var dieseBriefmarken = [];
							for (var k = 0; k < vorherigeBriefmarken.length; k++){
								dieseBriefmarken.push(vorherigeBriefmarken[k]);
							}
							dieseBriefmarken.push(aktuelleBriefmarke);
							if(differenz==0){
								//console.log('Es wurde eine optimale Lösung gefunden: ' + dieseBriefmarken);
								moeglichkeiten.push(dieseBriefmarken);
							}
							else {
								neuneuesPorto.push ([differenz, dieseBriefmarken]);
							}
						}
					}
				}
				neuesPorto = neuneuesPorto;
				//console.log(neuesPorto);
			}

			function moeglichkeitenUeberpruefen(){
				var ueberpruefteMoeglichkeiten = [];
				console.log('Möglichkeiten werden überprüft ...');
				console.log(moeglichkeiten);
				ueberpruefteMoeglichkeiten.push(moeglichkeiten[0]);
				for(var i = 0; i < moeglichkeiten.length-1; i++){//geht jede mögliche kombination durch
					var identisch = false;
					for (var k = i; k > (-1); k--){
						//console.log("i = " + i + "; k = " + k)
						var uebereinstimmend = 0;
						for(var j = 0; j < moeglichkeiten[i+1].length; j++){//geht jede Briefmarke der Kombination durch
							var found = moeglichkeiten[k].find(function(element){
								return element == moeglichkeiten[i+1][j];
							});
							//console.log(found);
							if(found !== undefined){
								uebereinstimmend++;
							}
						}
						if(uebereinstimmend==moeglichkeiten[i+1].length){
							//console.log('Array ist identisch');
							identisch = true
						}	
					}
					if (identisch==true){}
					else{
						//console.log('Array ist nicht identisch');
						ueberpruefteMoeglichkeiten.push(moeglichkeiten[i+1])
					}
				}	
				console.log('Überprüfung abgeschlossen ...');
				console.log(ueberpruefteMoeglichkeiten);
				return(ueberpruefteMoeglichkeiten);
			}

			function aufbereiten(){
				for (var i = 0; i < moeglichkeiten.length; i++){
					moeglichkeiten[i].sort(numSort);
				}
			}

			function main(){
				moeglichkeiten = [];
				console.log('aktuelles Porto beträgt: ' + aktuellesPorto);
				console.log('aktuell zur Verfügung stehende Briefmarken: ' + briefmarken);
				console.log('Stückelung in ' + anzahlBriefmarken + " Briefmarken")
				glattTeilbar();
				for(var m = 0; m < anzahlBriefmarken - 1; m++){
					algorithmus();
				}
				moeglichkeiten=moeglichkeitenUeberpruefen();
				//console.log(moeglichkeiten);
				aufbereiten();
				output();
				clear();
			}

			function numSort(a, b) {
				return (b - a);
			}

			function clear(){
				aktuelleBriefmarke = null;
				neuneuesPorto = null;
			}
			
			$( "#portoInputUser" ).change(function() {
				aktuellesPorto = parseFloat(document.getElementById('portoInputUser').value);
				main();
			})
			$( "#portoInputUserSelect" ).change(function() {
				aktuellesPorto = parseFloat(document.getElementById('portoInputUserSelect').value);
				main();
			})
			$( "#anzahlInputUser" ).change(function() {
				anzahlBriefmarken = parseFloat(document.getElementById('anzahlInputUser').value);
				main();
			})
			aktuellesPorto = parseFloat(document.getElementById('portoInputUserSelect').value);
			anzahlBriefmarken = parseFloat(document.getElementById('anzahlInputUser').value);
			main();
		</script>
	</body>
</html>